<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Xenon Boost</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700;800&family=Inter:wght@400;600;700&display=swap');
        
        :root {
            --bg: #030304;
            --surface: #0e0e10;
            --surface-2: #18181b;
            --primary: #5b21b6;
            --accent: #8b5cf6;
            --text: #ffffff;
            --gray: #71717a;
            --success: #10b981;
            --wait: #f59e0b;
            --danger: #ef4444;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            margin: 0; padding: 0;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(91, 33, 182, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 40%);
            background-attachment: fixed;
            min-height: 100vh;
            padding-bottom: 100px;
        }

        /* --- HEADER & TABS --- */
        .container { padding: 16px; max-width: 600px; margin: 0 auto; }
        
        .header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 24px;
        }
        .logo { font-family: 'Rajdhani', sans-serif; font-size: 24px; font-weight: 800; letter-spacing: 1px; color: #fff; text-shadow: 0 0 15px rgba(139,92,246,0.5); }
        .user-pill {
            background: rgba(255,255,255,0.05); padding: 6px 12px; border-radius: 20px;
            font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .nav {
            display: flex; background: var(--surface); padding: 4px; border-radius: 12px;
            margin-bottom: 24px; border: 1px solid rgba(255,255,255,0.05);
        }
        .nav-item {
            flex: 1; text-align: center; padding: 10px; font-size: 12px; font-weight: 700;
            color: var(--gray); border-radius: 8px; cursor: pointer; transition: 0.3s;
            text-transform: uppercase;
        }
        .nav-item.active { background: var(--surface-2); color: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }

        /* --- VIEWS --- */
        .view { display: none; animation: fadeUp 0.3s ease forwards; }
        .view.active { display: block; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- STEP 1: MODE SELECTOR --- */
        .mode-card {
            background: var(--surface); border: 1px solid rgba(255,255,255,0.05);
            border-radius: 16px; padding: 20px; margin-bottom: 12px;
            display: flex; align-items: center; justify-content: space-between;
            cursor: pointer; transition: 0.2s; position: relative; overflow: hidden;
        }
        .mode-card:active { transform: scale(0.98); border-color: var(--accent); }
        .mode-info h3 { margin: 0 0 4px 0; font-family: 'Rajdhani', sans-serif; font-size: 20px; text-transform: uppercase; }
        .mode-info p { margin: 0; font-size: 12px; color: var(--gray); }
        .mode-icon { font-size: 24px; }
        .mode-card.selected { border-color: var(--accent); background: rgba(139,92,246,0.1); }

        /* --- STEP 2 & 3: RANK GRID --- */
        .step-title { font-size: 14px; color: var(--gray); text-transform: uppercase; font-weight: 700; margin-bottom: 12px; text-align: center; }
        
        .ranks-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .rank-card {
            background: var(--surface); border-radius: 12px; padding: 10px 5px;
            text-align: center; border: 1px solid rgba(255,255,255,0.05);
            cursor: pointer; transition: 0.2s;
        }
        .rank-card img { width: 40px; height: 40px; object-fit: contain; margin-bottom: 5px; filter: drop-shadow(0 0 5px rgba(0,0,0,0.5)); }
        .rank-name { font-size: 10px; font-weight: 700; color: #ccc; text-transform: uppercase; }
        
        .rank-card.active { border-color: var(--accent); background: rgba(139,92,246,0.15); box-shadow: 0 0 10px rgba(139,92,246,0.2); }
        .rank-card.disabled { opacity: 0.3; pointer-events: none; filter: grayscale(1); }

        /* --- SUMMARY & PRICE --- */
        .summary-box {
            background: var(--surface-2); border-radius: 16px; padding: 20px;
            margin-top: 20px; border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }
        .summary-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 13px; }
        .price-display { font-family: 'Rajdhani', sans-serif; font-size: 32px; font-weight: 800; color: var(--accent); margin-top: 10px; }

        /* --- PROFILE --- */
        .profile-header { text-align: center; margin-bottom: 30px; }
        .p-avatar { width: 80px; height: 80px; background: linear-gradient(135deg, var(--primary), var(--accent)); border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 30px; font-weight: 800; box-shadow: 0 0 20px rgba(139,92,246,0.4); }
        .p-name { font-size: 20px; font-weight: 700; }
        .p-id { font-size: 12px; color: var(--gray); }

        .history-title { font-size: 12px; font-weight: 700; color: var(--gray); text-transform: uppercase; margin-bottom: 10px; letter-spacing: 1px; }
        .order-item {
            background: var(--surface); padding: 15px; border-radius: 12px; margin-bottom: 10px;
            border-left: 3px solid var(--gray); display: flex; justify-content: space-between; align-items: center;
        }
        /* Status Colors */
        .status-wait { border-color: var(--wait); } 
        .status-work { border-color: #3b82f6; background: rgba(59, 130, 246, 0.05); }
        .status-done { border-color: var(--success); }
        .status-reject { border-color: var(--danger); opacity: 0.7; }

        .order-info div:first-child { font-weight: 600; font-size: 13px; margin-bottom: 4px; }
        .order-info div:last-child { font-size: 11px; color: var(--gray); }
        .order-badge { padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 800; text-transform: uppercase; color: #000; }
        
        .badge-wait { background: var(--wait); }
        .badge-work { background: #3b82f6; color: #fff; }
        .badge-done { background: var(--success); }
        .badge-reject { background: var(--danger); color: #fff; }

        /* --- MAIN BUTTON --- */
        .main-btn {
            position: fixed; bottom: 20px; left: 16px; right: 16px;
            background: var(--text); color: #000;
            padding: 16px; border-radius: 14px;
            font-size: 16px; font-weight: 800; text-transform: uppercase;
            text-align: center; cursor: pointer; box-shadow: 0 5px 20px rgba(255,255,255,0.1);
            transition: 0.2s; display: none; z-index: 100;
        }
        .main-btn:active { transform: scale(0.98); }

        /* Navigation Arrows */
        .back-btn { color: var(--gray); font-size: 14px; margin-bottom: 15px; cursor: pointer; display: inline-block; }

    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <div class="logo">XENON</div>
            <div class="user-pill">
                <span id="user-name">Guest</span>
            </div>
        </div>

        <div class="nav">
            <div class="nav-item active" onclick="switchTab('boost')">–ó–∞–∫–∞–∑–∞—Ç—å –ë—É—Å—Ç</div>
            <div class="nav-item" onclick="switchTab('profile')">–ü—Ä–æ—Ñ–∏–ª—å</div>
        </div>

        <div id="view-boost" class="view active">
            
            <div id="step-1">
                <div class="step-title">1. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º</div>
                <div class="mode-card" onclick="selectMode('mm')">
                    <div class="mode-info"><h3>–°–æ—Ä–µ–≤–Ω–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π</h3><p>–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º 5x5</p></div>
                    <div class="mode-icon">üèÜ</div>
                </div>
                <div class="mode-card" onclick="selectMode('wingman')">
                    <div class="mode-info"><h3>–°–æ—é–∑–Ω–∏–∫–∏</h3><p>–†–µ–∂–∏–º 2x2</p></div>
                    <div class="mode-icon">ü§ù</div>
                </div>
                <div class="mode-card" onclick="selectMode('duels')">
                    <div class="mode-info"><h3>–î—É—ç–ª–∏</h3><p>1x1 –°–Ω–∞–π–ø–µ—Ä—ã</p></div>
                    <div class="mode-icon">üéØ</div>
                </div>
            </div>

            <div id="step-2" style="display:none">
                <div class="back-btn" onclick="gotoStep(1)">‚Üê –ù–∞–∑–∞–¥</div>
                <div class="step-title">2. –í–∞—à —Ç–µ–∫—É—â–∏–π —Ä–∞–Ω–≥</div>
                <div class="ranks-grid" id="grid-current"></div>
            </div>

            <div id="step-3" style="display:none">
                <div class="back-btn" onclick="gotoStep(2)">‚Üê –ù–∞–∑–∞–¥</div>
                <div class="step-title">3. –ñ–µ–ª–∞–µ–º—ã–π —Ä–∞–Ω–≥</div>
                <div class="ranks-grid" id="grid-target"></div>
            </div>

            <div id="step-4" style="display:none">
                <div class="back-btn" onclick="gotoStep(3)">‚Üê –ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞–Ω–≥–∏</div>
                <div class="summary-box">
                    <div class="summary-row">
                        <span style="color:#888">–†–µ–∂–∏–º:</span>
                        <span id="sum-mode" style="font-weight:bold">...</span>
                    </div>
                    <div class="summary-row">
                        <span style="color:#888">–ë—É—Å—Ç:</span>
                        <span><span id="sum-from"></span> ‚ûî <span id="sum-to" style="color:var(--accent)"></span></span>
                    </div>
                    <div class="price-display" id="final-price">0‚ÇΩ</div>
                    <div style="font-size:11px; color:#555; margin-top:5px">–¶–µ–Ω–∞ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</div>
                </div>
            </div>

        </div>

        <div id="view-profile" class="view">
            <div class="profile-header">
                <div class="p-avatar" id="p-avatar">?</div>
                <div class="p-name" id="p-name">Loading...</div>
                <div class="p-id" id="p-id">ID: ...</div>
            </div>

            <div class="history-title">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</div>
            <div id="orders-list">
                </div>
            <div id="no-orders" style="text-align:center; color:#444; font-size:12px; margin-top:20px; display:none">
                –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø—É—Å—Ç–∞
            </div>
        </div>

    </div>

    <div id="main-btn" class="main-btn">–û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // --- CONFIG ---
    // –¶–µ–Ω—ã –∑–∞ –®–ê–ì (–Ω–∞–ø—Ä–∏–º–µ—Ä –æ—Ç Gold 1 –¥–æ Gold 2)
    // –ß–µ–º –≤—ã—à–µ —Ä–∞–Ω–≥, —Ç–µ–º –¥–æ—Ä–æ–∂–µ —à–∞–≥
    const RANKS = [
        { id: 0, name: "Bronze I", img: "bronze1.png", price: 50 },
        { id: 1, name: "Bronze II", img: "bronze2.png", price: 50 },
        { id: 2, name: "Bronze III", img: "bronze3.png", price: 50 },
        { id: 3, name: "Bronze IV", img: "bronze4.png", price: 60 },
        
        { id: 4, name: "Silver I", img: "silver1.png", price: 80 },
        { id: 5, name: "Silver II", img: "silver2.png", price: 80 },
        { id: 6, name: "Silver III", img: "silver3.png", price: 90 },
        { id: 7, name: "Silver IV", img: "silver4.png", price: 100 },

        { id: 8, name: "Gold I", img: "gold1.png", price: 150 },
        { id: 9, name: "Gold II", img: "gold2.png", price: 160 },
        { id: 10, name: "Gold III", img: "gold3.png", price: 170 },
        { id: 11, name: "Gold IV", img: "gold4.png", price: 180 },

        { id: 12, name: "Phoenix", img: "phoenix.png", price: 300 },
        { id: 13, name: "Ranger", img: "ranger.png", price: 450 },
        { id: 14, name: "Champion", img: "champion.png", price: 600 },
        { id: 15, name: "Master", img: "master.png", price: 900 },
        { id: 16, name: "Elite", img: "elite.png", price: 1500 },
        { id: 17, name: "Legend", img: "legend.png", price: 2500 }
    ];

    // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Ä–µ–∂–∏–º–æ–≤
    const MODE_MULTIPLIERS = {
        'mm': 1.0,     // –°–æ—Ä–µ–≤–Ω–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π - —Å—Ç–∞–Ω–¥–∞—Ä—Ç
        'wingman': 0.8, // –ù–∞–ø–∞—Ä–Ω–∏–∫–∏ - –¥–µ—à–µ–≤–ª–µ
        'duels': 1.2    // –î—É—ç–ª–∏ - –¥–æ—Ä–æ–∂–µ (—Å–ª–æ–∂–Ω–µ–µ)
    };
    
    const MODE_NAMES = { 'mm': '–°–æ—Ä–µ–≤–Ω–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π', 'wingman': '–ù–∞–ø–∞—Ä–Ω–∏–∫–∏', 'duels': '–î—É—ç–ª–∏' };

    // --- STATE ---
    let state = {
        mode: null,
        currentRankIdx: null,
        targetRankIdx: null
    };

    // --- INIT ---
    function init() {
        const urlParams = new URLSearchParams(window.location.search);
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        const name = urlParams.get('name') || "Guest";
        const uid = urlParams.get('uid') || "0000";
        
        // –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø–∞—Ä—Å–∏–º –∏—Å—Ç–æ—Ä–∏—é –∑–∞–∫–∞–∑–æ–≤
        let orders = [];
        try {
            const ordersRaw = urlParams.get('orders');
            if (ordersRaw) orders = JSON.parse(decodeURIComponent(ordersRaw));
        } catch (e) { console.error("Error parsing orders", e); }

        // –ó–∞–ø–æ–ª–Ω—è–µ–º UI
        document.getElementById('user-name').innerText = name;
        document.getElementById('p-name').innerText = name;
        document.getElementById('p-id').innerText = `ID: ${uid}`;
        document.getElementById('p-avatar').innerText = name[0].toUpperCase();

        renderOrders(orders);
        renderRanks(); // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–µ—Ç–∫—É —Ä–∞–Ω–≥–æ–≤
    }

    // --- RENDER RANKS ---
    function renderRanks() {
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–µ—Ç–∫—É –¥–ª—è —à–∞–≥–∞ 2 (–¢–µ–∫—É—â–∏–π)
        const gridCurr = document.getElementById('grid-current');
        const gridTarg = document.getElementById('grid-target');
        
        RANKS.forEach((rank, idx) => {
            // –ö–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞–Ω–≥–∞
            const card1 = createRankCard(rank, idx, 'current');
            gridCurr.appendChild(card1);

            // –ö–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è –∂–µ–ª–∞–µ–º–æ–≥–æ —Ä–∞–Ω–≥–∞
            const card2 = createRankCard(rank, idx, 'target');
            gridTarg.appendChild(card2);
        });
    }

    function createRankCard(rank, idx, type) {
        const el = document.createElement('div');
        el.className = 'rank-card';
        el.id = `${type}-rank-${idx}`;
        el.innerHTML = `
            <img src="${rank.img}" onerror="this.src='bronze1.png'">
            <div class="rank-name">${rank.name}</div>
        `;
        el.onclick = () => selectRank(idx, type);
        return el;
    }

    // --- LOGIC ---
    function switchTab(tab) {
        document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        
        if (tab === 'boost') {
            document.getElementById('view-boost').classList.add('active');
            document.querySelectorAll('.nav-item')[0].classList.add('active');
            updateMainButtonVisibility();
        } else {
            document.getElementById('view-profile').classList.add('active');
            document.querySelectorAll('.nav-item')[1].classList.add('active');
            document.getElementById('main-btn').style.display = 'none';
        }
        if(tg.HapticFeedback) tg.HapticFeedback.selectionChanged();
    }

    function gotoStep(step) {
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —à–∞–≥–∏
        for(let i=1; i<=4; i++) document.getElementById(`step-${i}`).style.display = 'none';
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π
        document.getElementById(`step-${step}`).style.display = 'block';
        updateMainButtonVisibility();
    }

    function selectMode(mode) {
        state.mode = mode;
        if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
        gotoStep(2);
    }

    function selectRank(idx, type) {
        if(tg.HapticFeedback) tg.HapticFeedback.selectionChanged();

        if (type === 'current') {
            state.currentRankIdx = idx;
            // –°–±—Ä–æ—Å —Ç–∞—Ä–≥–µ—Ç–∞ –µ—Å–ª–∏ –æ–Ω –º–µ–Ω—å—à–µ —Ç–µ–∫—É—â–µ–≥–æ
            if (state.targetRankIdx !== null && state.targetRankIdx <= idx) state.targetRankIdx = null;
            
            highlightRank('current', idx);
            gotoStep(3);
            updateTargetGridAvailability(idx); // –ë–ª–æ–∫–∏—Ä—É–µ–º —Ä–∞–Ω–≥–∏ –Ω–∏–∂–µ —Ç–µ–∫—É—â–µ–≥–æ
        } 
        else if (type === 'target') {
            state.targetRankIdx = idx;
            highlightRank('target', idx);
            calculatePrice();
            gotoStep(4);
        }
    }

    function highlightRank(type, idx) {
        // –°–±—Ä–æ—Å –∞–∫—Ç–∏–≤–Ω—ã—Ö
        document.querySelectorAll(`#grid-${type} .rank-card`).forEach(el => el.classList.remove('active'));
        // –°–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ
        document.getElementById(`${type}-rank-${idx}`).classList.add('active');
    }

    function updateTargetGridAvailability(currentIdx) {
        RANKS.forEach((r, i) => {
            const card = document.getElementById(`target-rank-${i}`);
            if (i <= currentIdx) card.classList.add('disabled');
            else card.classList.remove('disabled');
        });
    }

    function calculatePrice() {
        if (state.currentRankIdx === null || state.targetRankIdx === null) return;
        
        let rawPrice = 0;
        // –°—É–º–º–∏—Ä—É–µ–º —Ü–µ–Ω—É –ö–ê–ñ–î–û–ì–û —à–∞–≥–∞ –æ—Ç (Current + 1) –¥–æ Target
        // –ü—Ä–∏–º–µ—Ä: Bronze 1 -> Bronze 3. –°—á–∏—Ç–∞–µ–º —Ü–µ–Ω—É Bronze 2 + Bronze 3.
        for (let i = state.currentRankIdx + 1; i <= state.targetRankIdx; i++) {
            rawPrice += RANKS[i].price;
        }

        const multiplier = MODE_MULTIPLIERS[state.mode];
        const finalPrice = Math.round(rawPrice * multiplier);

        // –û–±–Ω–æ–≤–ª—è–µ–º UI
        document.getElementById('sum-mode').innerText = MODE_NAMES[state.mode];
        document.getElementById('sum-from').innerText = RANKS[state.currentRankIdx].name;
        document.getElementById('sum-to').innerText = RANKS[state.targetRankIdx].name;
        document.getElementById('final-price').innerText = finalPrice + "‚ÇΩ";
        
        state.finalPrice = finalPrice;
    }

    function updateMainButtonVisibility() {
        const btn = document.getElementById('main-btn');
        const step4 = document.getElementById('step-4');
        
        if (step4.style.display === 'block') {
            btn.innerText = `–û–ü–õ–ê–¢–ò–¢–¨ ${state.finalPrice}‚ÇΩ`;
            btn.style.display = 'block';
            btn.onclick = sendOrder;
        } else {
            btn.style.display = 'none';
        }
    }

    function sendOrder() {
        if(tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
        
        const data = {
            name: `${MODE_NAMES[state.mode]}: ${RANKS[state.currentRankIdx].name} -> ${RANKS[state.targetRankIdx].name}`,
            price: state.finalPrice
        };
        
        tg.sendData(JSON.stringify(data));
        tg.close();
    }

    // --- ORDER HISTORY RENDER ---
    function renderOrders(orders) {
        const list = document.getElementById('orders-list');
        const empty = document.getElementById('no-orders');
        
        if (!orders || orders.length === 0) {
            empty.style.display = 'block';
            return;
        }

        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
        orders.reverse().forEach(o => {
            let statusText = '–û–∂–∏–¥–∞–Ω–∏–µ';
            let badgeClass = 'badge-wait';
            let borderClass = 'status-wait';

            if (o.status === 'work') { statusText = '–í —Ä–∞–±–æ—Ç–µ'; badgeClass = 'badge-work'; borderClass = 'status-work'; }
            if (o.status === 'done') { statusText = '–í—ã–ø–æ–ª–Ω–µ–Ω'; badgeClass = 'badge-done'; borderClass = 'status-done'; }
            if (o.status === 'reject') { statusText = '–û—Ç–∫–ª–æ–Ω–µ–Ω'; badgeClass = 'badge-reject'; borderClass = 'status-reject'; }

            const el = document.createElement('div');
            el.className = `order-item ${borderClass}`;
            el.innerHTML = `
                <div class="order-info">
                    <div>${o.desc}</div>
                    <div>–ó–∞–∫–∞–∑ #${o.id} ‚Ä¢ ${o.date} ‚Ä¢ ${o.price}‚ÇΩ</div>
                </div>
                <div class="order-badge ${badgeClass}">${statusText}</div>
            `;
            list.appendChild(el);
        });
    }

    init();

</script>
</body>
</html>
